<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Busca Spotify</title>
</head>
<body>
<input type="text" id="search-input" placeholder="Buscar artistas, músicas ou playlists..." />

<div>
  <h2>Artistas</h2>
  <div id="lista-artistas"></div>
</div>

<div>
  <h2>Músicas</h2>
  <div id="lista-musicas"></div>
</div>

<div>
  <h2>Playlists</h2>
  <div id="lista-playlists"></div>
</div>
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script>
  const searchArtists = async (query) => {
    try {
      const response = await fetch(`/api/spotify/search?query=${encodeURIComponent(query)}`);
      if (!response.ok) {
        throw new Error("Network response was not ok");
      }
      const data = await response.json();
      exibirResultados(data);
    } catch (error) {
      console.error("Erro ao buscar dados da API Spotify", error);
    }
  };

  const exibirResultados = (data) => {
    const listaArtistas = document.getElementById("lista-artistas");
    const listaMusicas = document.getElementById("lista-musicas");
    const listaPlaylists = document.getElementById("lista-playlists");

    listaArtistas.innerHTML = ""; // Limpa a lista de artistas
    listaMusicas.innerHTML = "";   // Limpa a lista de músicas
    listaPlaylists.innerHTML = "";  // Limpa a lista de playlists

    // Exibir artistas
    if (data.artists && data.artists.items.length > 0) {
      data.artists.items.forEach(artista => {
        const item = document.createElement('div');
        const imagemUrl = artista.images.length > 0 ? artista.images[0].url : 'https://via.placeholder.com/50';
        item.innerHTML = `
          <img src="${imagemUrl}" alt="${artista.name}" width="50" height="50" />
          <span>${artista.name}</span>
        `;
        listaArtistas.appendChild(item);
      });
    }

    // Exibir músicas
    if (data.tracks && data.tracks.items.length > 0) {
      data.tracks.items.forEach(musica => {
        const item = document.createElement('div');
        const imagemUrl = musica.album.images.length > 0 ? musica.album.images[0].url : 'https://via.placeholder.com/50';
        item.innerHTML = `
          <img src="${imagemUrl}" alt="${musica.name}" width="50" height="50" />
          <span>${musica.name}</span>
        `;
        listaMusicas.appendChild(item);
      });
    }

    // Exibir playlists
    if (data.playlists && data.playlists.items.length > 0) {
      data.playlists.items.forEach(playlist => {
        const item = document.createElement('div');
        const imagemUrl = playlist.images.length > 0 ? playlist.images[0].url : 'https://via.placeholder.com/50';
        item.innerHTML = `
          <img src="${imagemUrl}" alt="${playlist.name}" width="50" height="50" />
          <span>${playlist.name}</span>
        `;
        listaPlaylists.appendChild(item);
      });
    }
  };

  // Listener para a barra de busca
  document.querySelector('#search-input').addEventListener('input', (event) => {
    const query = event.target.value;
    if (query.length > 2) { // Apenas busca se o tamanho for maior que 2
      searchArtists(query);
    }
  });
</script>
</body>
</html>
